function processHours(e){var t="",n=0,a=e;return 1==a?"1 hour":(24>a?t=a+" hours":(n=parseInt(a/24),a%=24,t=1==n?"1 day":n+" days",7>n&&a>0&&(t+=" "+a+" hour",a>1&&(t+="s"))),t)}function loadEvents(){var e=myJsonObject;if(e)try{$("#div_container").empty(),$("#div_container").css("display","none"),$("#div_container").append($("<table>").attr("class","table_header table-striped danger").append($("<tbody>").attr("id","dataContainer")));var t=10*myPageNum,n=Math.min(t+10,myEventCount+1);$("#button_backward").prop("disabled",myPageNum>0||myPaginationNum>1?!1:!0),$("#button_forward").prop("disabled",myEventCount>10*(myPageNum+1)||myPageLimit>myPaginationNum?!1:!0);for(var a=t;n>a;a++)if(e.events[a]){var o="",s="missing event name";e.events[a].hasOwnProperty("name")&&e.events[a].name.hasOwnProperty("text")&&null!=e.events[a].name.text&&""!=e.events[a].name.text&&(s=e.events[a].name.text),o+="Event Name: "+s+"\n";var r="res/missing_bg.jpg";null!=e.events[a].logo&&e.events[a].logo.hasOwnProperty("url")&&null!=e.events[a].logo.url&&""!=e.events[a].logo.url&&(r=e.events[a].logo.url);var i="Unknown",m=moment.utc(),d=moment.utc(),c=!1,l=!1;e.events[a].hasOwnProperty("end")&&null!=e.events[a].start&&(e.events[a].start.hasOwnProperty("local")&&null!=e.events[a].start.local&&""!=e.events[a].start.local&&(i=moment(e.events[a].start.local).format("dddd, MMMM Do YYYY, h:mm:ss a")),e.events[a].start.hasOwnProperty("utc")&&null!=e.events[a].start.utc&&""!=e.events[a].start.utc&&(m=moment(e.events[a].start.utc),c=!0)),e.events[a].hasOwnProperty("end")&&null!=e.events[a].end&&e.events[a].end.hasOwnProperty("utc")&&null!=e.events[a].start.utc&&""!=e.events[a].start.utc&&(d=moment(e.events[a].end.utc),l=!0);var u="";c&&l&&(moment(m).isAfter(moment.utc())?u="<span class = 'timing_incoming'>[in "+processHours(moment(m).diff(moment.utc(),"hours"))+"]</span>":moment.utc().isBetween(m,d)?u="<span class = 'timing_started'>[Ongoing]</span>":moment(d).isBefore(moment.utc())&&(u="<span class = 'timing_passed'>[Passed]</span>"),s=u+"<br>"+s),o+="Time: "+i+"\n";var v="(none)";null!=e.events[a].description&&e.events[a].description.hasOwnProperty("text")&&null!=e.events[a].description.text&&""!=e.events[a].description.text&&(v=e.events[a].description.text.length<=500?e.events[a].description.text:e.events[a].description.text.substring(0,500)+"\n(and more...)"),o+="Description: \n"+v+"\n";var y="about:blank";e.events[a].hasOwnProperty("url")&&null!=e.events[a].url&&""!=e.events[a].url&&(y=e.events[a].url),$("#dataContainer").append($("<tr>").append($("<span>").attr("class","result_title").html(s))).append($("<tr>").append($("<td>").append($("<a>").attr("href",y).append($("<img>").attr("src",r).attr("alt",y).attr("title",o).bind("click",function(){chrome.tabs.create({url:this.alt,selected:!0})})))))}$("#div_container").fadeIn(750)}catch(p){console.log("Error: "+p.toString)}}function ajaxSuccess(e){return $("#div_container").empty(),myPaginationNum=e.pagination.page_number,myPageSize=e.pagination.page_size,myPageLimit=e.pagination.page_count,myJsonObject=e,myEventCount=Math.min(myPageSize,e.pagination.object_count),0==myEventCount?void $("#div_container").append($("<img>").attr("src","res/no_result.jpg")):void loadEvents()}function askEventbrite(){$("#img_loading").length||$("#div_container").prepend($("<img>").attr("src","res/loading.gif").attr("id","img_loading"));var e="ALL7YMMJU7W33ROWD2RD",t="https://www.eventbriteapi.com/v3/events/search/?",n="page="+myPaginationNum;n+=""!=myAddress?"&location.address="+myAddress:"&location.latitude="+myLat+"&location.longitude="+myLon,n+="&location.within="+myDistance+"mi",myKeyword&&(n+="&q="+myKeyword),"f"==myPrice?n+="&price=free":"p"==myPrice&&(n+="&price=paid");var a=moment().format("YYYY-MM-DDThh:mm:ss"),o=moment().format("YYYY-MM-DDThh:mm:ss");"weekend"==myTime?n+="&start_date.keyword=this_weekend":0!=myTime&&(o=moment().add(myTime,"days"),n+="&start_date.range_start="+moment(a).format("YYYY-MM-DDThh:mm:ss")+"&start_date.range_end="+moment(o).format("YYYY-MM-DDThh:mm:ss")),n+="&token="+e,$.ajax({url:t,crossDomain:!0,dataType:"json",data:n,type:"GET",success:function(e){ajaxSuccess(e)},error:function(e){console.log("there is error:"+e.message)}})}function mainProcess(){if(void 0===myLat&&""==$("#input_address").val()){if($("#img_loading").length||$("#div_container").prepend($("<img>").attr("src","res/loading.gif").attr("id","img_loading")),!navigator.geolocation)return $("#div_container").empty(),$("#div_container").html("Geolocation is not supported for this Browser/OS version yet. Please Manually type in your address..."),void console.log("Geolocation is not supported for this Browser/OS version yet.");var e,t=function(t){e=t,myLat=e.coords.latitude,myLon=e.coords.longitude,askEventbrite()},n=function(e){$("#div_container").empty(),$("#div_container").html("Cannot get location. Please Manually type in your address or Reload to get the current location...")};navigator.geolocation.getCurrentPosition(t,n)}else askEventbrite()}var myKeyword="",myDistance="5",myTime="weekend",myPrice="0",myAddress="",myJsonObject,myPageNum=0,myPaginationNum=1,myPageSize=50,myEventCount=0,myPageLimit=1,myLat,myLon;document.addEventListener("DOMContentLoaded",function(){$("#form_search").fadeIn(750),$("#button_search").click(function(){myKeyword=$("#input_keyword").val(),myDistance=$("#select_distance").val(),myTime=$("#select_time").val(),myPrice=$("#select_price").val(),myAddress=$("#input_address").val(),myPageNum=0,mainProcess()}),$("#button_forward").click(function(){10*(myPageNum+1)>=myPageSize?(myPageNum=0,myPaginationNum+=1,askEventbrite()):(myPageNum+=1,loadEvents())}),$("#button_backward").click(function(){0>=myPageNum?(myPageNum=parseInt((myPageSize-1)/10),myPaginationNum-=1,askEventbrite()):(myPageNum-=1,loadEvents())}),mainProcess()});